<!DOCTYPE html>
<head>
  <title>Infomation-monitor</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <style>
    .slideshow-container {
      max-width: 400px;
      position: relative;
      margin: auto;
      overflow: hidden;
    }
    .marquee {
      display: flex;
      white-space: nowrap;
      overflow: hidden;
      gap: 1rem;
      font-size: 3rem;
    }
    .slideshow-container {
      max-width: 400px;
      position: relative;
      margin: auto;
      overflow: hidden;
    }

    .slide {
      display: none;
      width: 100%;
      height: 100%;
      transition: opacity 1s ease-in-out;
    }

    .slide.active {
      display: block;
      opacity: 1;
    }
  </style>
</head>
<Body>
  <div style="display: block;" id="container">
  <div style="position: absolute; margin-left: 86%;">
    <h3 id="now_time" style="font-size: 30px;">《現在時刻》</h3>
  </div>
  <div id="slideshow-container" style="height: 650px;">
    <div class="slide active" id="content1">
      <span class="material-symbols-outlined" style="font-size: 10rem;">
        Info
      </span>
      <h3 style="font-size: 3rem;">「SOS」の際は、「1」キーを押してください。</h3>
      <h3 style="font-size: 3rem;">地震情報の優先表示を行う際は、「E」キーを押してください。</h3>
    </div>
    <div class="slide" id="content2">
      <span class="material-symbols-outlined" style="font-size: 9rem;">
        Earthquake
      </span>
      <h3 style="font-size: 1.7rem;">最新の地震情報</h3>
      <h3 id="title_e" style="font-size: 1.3rem; text-align: center;"></h3>
      <h3 id="c1_e" style="font-size: 1.3rem;"></h3>
      <h3 id="c2_e" style="font-size: 1.3rem;"></h3>
      <h3 id="time_e" style="font-size: 1.3rem;"></h3>
      <h3 id="hypocenter_e" style="font-size: 1.3rem;"></h3>
      <h3 id="maxint_e" style="font-size: 1.3rem;"></h3>
      <h3 id="mag_e" style="font-size: 1.3rem;"></h3>
      <h3 id="area_e" style="font-size: 1.3rem;"></h3>
    </div>
    <div class="slide" id="content3">
      <span class="material-symbols-outlined" style="font-size: 9rem;">
        thermostat
      </span>
      <h3 style="font-size: 1.5rem;">アメダス情報</h3>
      <h3 style="font-size: 1.7rem;">観測地点：東京(東京管区気象台管理)</h3>
      <table style="font-size: 1.7rem; width: 100%; text-align: center; font-weight: bold;">
        <tr>
          <td id="pressure"></td>
          <td id="n_pressure"></td>
        </tr>
        <tr>
          <td id="temp"></td>
          <td id="humidity"></td>
        </tr>
        <tr>
          <td id="snow1h"></td>
          <td id="snow6h"></td>
        </tr>
        <tr>
          <td id="snow12h"></td>
          <td id="snow24h"></td>
        </tr>
        <tr>
          <td id="sun10m"></td>
          <td id="sun1h"></td>
        </tr>
        <tr>
          <td id="precipi10m"></td>
          <td id="precipi1h"></td>
        </tr>
        <tr>
          <td id="precipi3h"></td>
          <td id="precipi24h"></td>
        </tr>
        <tr>
          <td id="windDirection"></td>
          <td id="wind"></td>
        </tr>
      </table>
    </div>
  </div>
  <div class="marquee" style="background-color: #6497f4; color: white;">
    <div class="marquee-inner">地震が発生したら、音声と文字にてお知らせいたします。「ここに、天気・過去の地震情報等を表記いたします【テスト】　札幌　☀　　青森　☁　　仙台　☁　　新潟　☀　　金沢　☁　　東京　☂　　　　《省略》　　　那覇　☂」</div>
    <div class="marquee-inner" aria-hidden="true">地震が発生したら、音声と文字にてお知らせいたします。「ここに、天気・過去の地震情報等を表記いたします【テスト】　札幌　☀　　青森　☁　　仙台　☁　　新潟　☀　　金沢　☁　　東京　☂　　　　《省略》　　　那覇　☂」</div>
  </div>
  </div>
  <div id="upDate" style="background-color: #6497f4; height: 750px; display: none; width: 100%; margin-top: 0px; padding-top: 0px;">
    <h2 style="text-align: center; color: white; font-size: 2.0rem; margin: 0px;">更新中</h2>
    <h3 style="text-align: center; color: white; font-size: 1.7rem;">毎時00分と30分は、データ更新の時間です。</h3>
    <h3 style="text-align: center; color: white; font-size: 1.7rem;">「U」キーを押すことで、更新することもできます。</h3>
  </div>
  <script>
    function update() {
      var element = document.getElementById("now_time");
      element.textContent = new Date().toLocaleTimeString();; // 現在時刻を表示

      // 次の更新処理を予約
      setTimeout(update, 1000); // 1秒後に再度実行
    }

    // 初回の更新処理を開始
    update();
  </script>
  <script>
    function AmeDasu() {
    // URLからJSONデータを取得する例// 現在の日時を取得
    const currentDate = new Date();

    // 年月日時分秒を取得
    const year = currentDate.getFullYear();
    const month = String(currentDate.getMonth() + 1).padStart(2, '0');
    const day = String(currentDate.getDate()).padStart(2, '0');
    const hours = String(currentDate.getHours()).padStart(2, '0');
    const minutes = String(currentDate.getMinutes()).padStart(2, '0');
      if(minutes > 10){
        const formattedDate = `${year}${month}${day}${hours}`;
        // 指定された形式の数値を作成
        var json_url = 'https://www.jma.go.jp/bosai/amedas/data/map/' + formattedDate + '0000.json'
      }else{
        const hours_c = hours-1
        const formattedDate = `${year}${month}${day}${hours_c}`;
        // 指定された形式の数値を作成
        var json_url = 'https://www.jma.go.jp/bosai/amedas/data/map/' + formattedDate + '0000.json'
      }

    const url = json_url;
    fetch(url)
      .then(response => response.json())
      .then(data => {
        // "10"の中の値を取得
        const pressure  = data["44132"].pressure[0];
        const n_pressure  = data["44132"].normalPressure[0];
        const temp  = data["44132"].temp[0];
        const humidity  = data["44132"].humidity[0];
        const snow1h  = data["44132"].snow1h[0];
        const snow6h  = data["44132"].snow6h[0];
        const snow12h  = data["44132"].snow12h[0];
        const snow24h  = data["44132"].snow24h[0];
        const sun10m  = data["44132"].sun10m[0];
        const sun1h  = data["44132"].sun1h[0];
        const precipi10m  = data["44132"].precipitation10m[0];
        const precipi1h  = data["44132"].precipitation1h[0];
        const precipi3h  = data["44132"].precipitation3h[0];
        const precipi24h  = data["44132"].precipitation24h[0];
        const windDirection  = data["44132"].windDirection[0];
        const wind  = data["44132"].wind[0];
        var windDirection_c = "";
        if(windDirection === 0){
          windDirection_c = "静穏"
        }else if(windDirection === 1){
          windDirection_c = "北北東"
        }else if(windDirection === 2){
          windDirection_c = "北東"
        }else if(windDirection === 3){
          windDirection_c = "東北東"
        }else if(windDirection === 4){
          windDirection_c = "東"
        }else if(windDirection === 5){
          windDirection_c = "東南東"
        }else if(windDirection === 6){
          windDirection_c = "南東"
        }else if(windDirection === 7){
          windDirection_c = "南南東"
        }else if(windDirection === 8){
          windDirection_c = "南"
        }else if(windDirection === 9){
          windDirection_c = "南南西"
        }else if(windDirection === 10){
          windDirection_c = "南西"
        }else if(windDirection === 11){
          windDirection_c = "西南西"
        }else if(windDirection === 12){
          windDirection_c = "西"
        }else if(windDirection === 13){
          windDirection_c = "西北西"
        }else if(windDirection === 14){
          windDirection_c = "北西"
        }else if(windDirection === 15){
          windDirection_c = "北北西"
        }else if(windDirection === 16){
          windDirection_c = "北"
        }
        document.getElementById('pressure').textContent = "気圧：" + pressure + "hPa";
        document.getElementById('n_pressure').textContent = "気圧(平均)：" + n_pressure + "hPa";
        document.getElementById('temp').textContent = "気温：" + temp + "℃";
        document.getElementById('humidity').textContent = "湿度：" + humidity + "%";
        document.getElementById('snow1h').textContent = "降雪量(1時間)：" + snow1h + "cm";
        document.getElementById('snow6h').textContent = "降雪量(6時間)：" + snow6h + "cm";
        document.getElementById('snow12h').textContent = "降雪量(12時間)：" + snow12h + "cm";
        document.getElementById('snow24h').textContent = "降雪量(24時間)：" + snow24h + "cm";
        document.getElementById('sun10m').textContent = "日照時間(10分)：" + sun10m + "min";
        document.getElementById('sun1h').textContent = "日照時間(1時間)：" + sun1h + "min";
        document.getElementById('precipi10m').textContent = "降水量(10分間)：" + precipi10m + "mm";
        document.getElementById('precipi1h').textContent = "降水量(1時間)：" + precipi1h + "mm";
        document.getElementById('precipi3h').textContent = "降水量(3時間)：" + precipi3h + "mm";
        document.getElementById('precipi24h').textContent = "降水量(24時間)：" + precipi24h + "mm";
        document.getElementById('windDirection').textContent = "風向：" + windDirection_c;
        document.getElementById('wind').textContent = "風速：" + wind + "m/s";
      })
      .catch(error => console.error("Error fetching data:", error));
    }
    AmeDasu();
  </script>
  <script>
    function quake() {
    const url = "https://www.jma.go.jp/bosai/quake/data/list.json";
    fetch(url)
      .then(response => response.json())
      .then(data => {
        const json_url  = data[0].json;
        const json_url_c = "https://www.jma.go.jp/bosai/quake/data/" + json_url;
           fetch(json_url_c)
          .then(response => response.json())
          .then(data => {
            const title  = data.Control.Title;
            const coment1  = data.Head.Headline.Text;
            const time = data.Body.Earthquake.OriginTime;
            const hypocenter = data.Body.Earthquake.Hypocenter.Area.Name;
            const mag = data.Body.Earthquake.Magnitude;
            const coment2 = data.Body.Comments.ForecastComment.Text;
            const maxint = data.Body.Intensity.Observation.MaxInt;
            for (const prefObject of data.Body.Intensity.Observation.Pref) {
              var einfo;
              const einfo_area = prefObject.Name;
              const einfo_area_int = prefObject.MaxInt;
              if(einfo){
              einfo = einfo + "【" + einfo_area + "】 震度" + einfo_area_int + "　";
              }else {
              einfo = "【" + einfo_area + "】 震度" + einfo_area_int + "　";
              }
            }
            const dateObject = new Date(time);

            const year = dateObject.getFullYear().toString().slice(-2); // 下2桁を取得
            const month = (dateObject.getMonth() + 1).toString().padStart(2, '0');
            const day = dateObject.getDate().toString().padStart(2, '0');
            const hours = dateObject.getHours().toString().padStart(2, '0');
            const minutes = dateObject.getMinutes().toString().padStart(2, '0');

            time_e = `${year}年${month}月${day}日 ${hours}時${minutes}分`;
            document.getElementById("title_e").textContent = title;
            document.getElementById("c1_e").textContent = coment1;
            document.getElementById("c2_e").textContent = coment2;
            document.getElementById("time_e").textContent = "発生時刻：" + time_e;
            document.getElementById("hypocenter_e").textContent = "震源地：" + hypocenter;
            document.getElementById("mag_e").textContent = "マグニチュード：" + mag;
            document.getElementById("maxint_e").textContent = "最大震度：" + maxint;
            document.getElementById("area_e").textContent = "震度観測値：" + einfo;
            setTimeout(quake, 60000); // 1秒後に再度実行
          })
          .catch(error => console.error("Error fetching data:", error));
      })
      .catch(error => console.error("Error fetching data:", error));
    }
    quake();
  </script>
  <script>
  function audio() {
  // 音楽ファイルのURLを指定
  var audioFile = '../audio/final_audio.mp3';
  
  const currentDate = new Date();
  const hours = String(currentDate.getHours()).padStart(2, '0');
  const minutes = String(currentDate.getMinutes()).padStart(2, '0');
    if(minutes === "45" && hours === "21"){
      // Audioオブジェクトを作成
      var audio = new Audio(audioFile);
      // 音楽再生
      audio.play();
    }
    setTimeout(audio, 60000); // 1秒後に再度実行
  }
    audio();
  </script>
  <script>
    function dataUp(){
      $('#upDate').fadeIn(3000, function() {
        console.log('フェードインされました！');
      });
      $('#container').fadeOut(3000, function() {
        console.log('フェードアウトされました！');
      });
      AmeDasu()
      quake()
      var newTime_M = new Date().getMinutes();
      var newTime_S = new Date().getSeconds();
      if(newTime_M < 30){
        var time_M_S = 1800000 - (newTime_M*60000 + newTime_S*1000)
      }else{
        var time_M_S = 3600000 - (newTime_M*60000 + newTime_S*1000)
      }
      console.log(time_M_S)
      setTimeout(dataUp, time_M_S); // 1秒後に再度実行
      setTimeout(function(){
      $('#container').fadeIn(3000, function() {
        console.log('フェードインされました！');
      });
      $('#upDate').fadeOut(3000, function() {
        console.log('フェードアウトされました！');
      });
      }, 15000);
    }
    dataUp();
  </script>
  <script src="./js/slide-content.js"></script>
  <script src="./js/text-scroll.js"></script>
</Body>
</html>
